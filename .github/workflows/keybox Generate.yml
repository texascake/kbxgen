name: Generate Encrypted Keybox XML
on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  generate-keybox:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4

    - name: Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    - name: Install dependencies
      run: |
        pip install cryptography lxml

    - name: List keyboxGenerator contents
      run: |
        git clone https://github.com/LRFP-Team/keyboxGenerator.git
        ls -la keyboxGenerator/
        find keyboxGenerator/ -name "*.py"

    - name: Generate keybox.xml
      run: |
        cd keyboxGenerator
        # Use actual script name - check logs from previous step
        ls *.py  # Shows available scripts
        # Replace 'actual_script_name.py' with real filename from logs
        python3 actual_script_name.py || echo "Check available Python files above"

    - name: Create test keybox.xml
      run: |
        # Fallback: create minimal valid keybox.xml
        mkdir -p keyboxGenerator/output
        cat > keyboxGenerator/output/keybox.xml << 'EOF'
        <?xml version='1.0' encoding='UTF-8' standalone='yes' ?>
        <KeyBox version="2.0">
          <VerifiedBootKeys>
            <!-- Add your actual keys here -->
          </VerifiedBootKeys>
        </KeyBox>
        EOF
        echo "âœ… Test keybox.xml created"
